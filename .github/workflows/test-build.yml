name: OmniVersion Hybrid Build

on:
  push:
    branches: ["main"]
    tags:
      - "v*"

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: "8.1"
          extensions: mbstring, xml, curl, yaml, sqlite3
          coverage: none

      - name: Verify PHP version
        run: php -v

      # Composer by GitHub Action (anti-error)
      - name: Install Composer Dependencies
        uses: php-actions/composer@v6
        with:
          php_version: "8.1"
          dev: no

      - name: Download PocketMine-MP
        run: |
          mkdir -p pmmp
          wget https://github.com/pmmp/PocketMine-MP/releases/latest/download/PocketMine-MP.phar -O pmmp/PocketMine-MP.phar

      - name: Build Plugin PHAR
        run: |
          php build/build.php
          mv OmniVersion.phar build/OmniVersion.phar

      - name: Upload Artifact
        uses: actions/upload-artifact@v4
        with:
          name: OmniVersion-Build
          path: build/OmniVersion.phar